# LUNA16 Lung Nodule Segmentation with 3D U-Net

Production-ready –ø—Ä–æ–µ–∫—Ç –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ (–ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏) —É–∑–µ–ª–∫–æ–≤ –≤ –ö–¢-—Å–Ω–∏–º–∫–∞—Ö –ª—ë–≥–∫–∏—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º 3D U-Net –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç–µ LUNA16.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –≥–ª—É–±–æ–∫–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –Ω–∞ –∑–∞–¥–∞—á—É voxel-wise —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ —É–∑–µ–ª–∫–æ–≤ –ª—ë–≥–∫–∏—Ö:

- **–ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞**: –∑–∞–≥—Ä—É–∑–∫–∞ .mhd/.raw —Ñ–∞–π–ª–æ–≤, —Ä–µ—Å—ç–º–ø–ª–∏–Ω–≥ –∫ spacing 1x1x1 –º–º, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è HU, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∫ 256√ó256√ó64
- **–ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏**: –≤—Ä–∞—â–µ–Ω–∏—è, –æ—Ç—Ä–∞–∂–µ–Ω–∏—è, —à—É–º, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏, –∞—Ñ—Ñ–∏–Ω–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
- **–ú–æ–¥–µ–ª—å**: 3D U-Net —Å batch normalization, PReLU –∞–∫—Ç–∏–≤–∞—Ü–∏—è–º–∏
- **–û–±—É—á–µ–Ω–∏–µ**: Dice + BCE loss, AdamW –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä, Cosine Annealing LR scheduler, mixed precision training
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ø–æ–¥—Ä–æ–±–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (Dice, Sensitivity, Precision, Recall)
- **–ò–Ω—Ñ–µ—Ä–µ–Ω—Å**: –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –º–∞—Å–æ–∫, –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —É–∑–µ–ª–∫–æ–≤, –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
luna16_segmentation/
‚îú‚îÄ‚îÄ README.md                  # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ requirements.txt           # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ utils.py                   # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ preprocess.py              # –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ dataset.py                 # PyTorch Dataset
‚îú‚îÄ‚îÄ model.py                   # 3D U-Net –º–æ–¥–µ–ª—å
‚îú‚îÄ‚îÄ train.py                   # –°–∫—Ä–∏–ø—Ç –æ–±—É—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ validate.py                # –°–∫—Ä–∏–ø—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ infer.py                   # –°–∫—Ä–∏–ø—Ç –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞
‚îî‚îÄ‚îÄ data/
    ‚îî‚îÄ‚îÄ LUNA16/
        ‚îú‚îÄ‚îÄ raw/               # –ò—Å—Ö–æ–¥–Ω—ã–µ .mhd/.raw —Ñ–∞–π–ª—ã
        ‚îú‚îÄ‚îÄ annotations.csv    # –ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —É–∑–µ–ª–∫–æ–≤
        ‚îú‚îÄ‚îÄ seg-lungs-LUNA16/  # –ú–∞—Å–∫–∏ –ª—ë–≥–∫–∏—Ö
        ‚îî‚îÄ‚îÄ processed/         # –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –° –ø–æ–º–æ—â—å—é conda (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
conda create -n luna16 python=3.10
conda activate luna16

# –ò–ª–∏ —Å –ø–æ–º–æ—â—å—é venv
python -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate   # Windows
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PyTorch (–≤—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ä—Å–∏—é –¥–ª—è –≤–∞—à–µ–π CUDA)
# –î–ª—è CUDA 11.8:
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118

# –î–ª—è CUDA 12.1:
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121

# –î–ª—è CPU:
pip install torch torchvision torchaudio

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt
```

## üìä –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞ LUNA16

–°–∫–∞—á–∞–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã —Å [LUNA16 –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞](https://luna16.grand-challenge.org/Download/):

- **–°—É–±—Å–µ—Ç—ã 0-9**: —Ñ–∞–π–ª—ã .mhd/.raw —Å –ö–¢-—Å–Ω–∏–º–∫–∞–º–∏
- **annotations.csv**: –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏ –¥–∏–∞–º–µ—Ç—Ä—ã —É–∑–µ–ª–∫–æ–≤
- **seg-lungs-LUNA16.zip**: –º–∞—Å–∫–∏ –ª—ë–≥–∫–∏—Ö

### 2. –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª—ã —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```
data/LUNA16/
‚îú‚îÄ‚îÄ raw/
‚îÇ   ‚îú‚îÄ‚îÄ 1.3.6.1.4.1.14519.5.2.1.6279.6001.*.mhd
‚îÇ   ‚îú‚îÄ‚îÄ 1.3.6.1.4.1.14519.5.2.1.6279.6001.*.raw
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ annotations.csv
‚îî‚îÄ‚îÄ seg-lungs-LUNA16/
    ‚îú‚îÄ‚îÄ 1.3.6.1.4.1.14519.5.2.1.6279.6001.*.mhd
    ‚îî‚îÄ‚îÄ ...
```

### 3. –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏:

```bash
python preprocess.py
```

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏ (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ `preprocess.py`):
- **target_spacing**: (1.0, 1.0, 1.0) –º–º
- **target_size**: (64, 256, 256) –≤–æ–∫—Å–µ–ª–µ–π (z, y, x)
- **HU range**: [-1000, 400]

–†–µ–∑—É–ª—å—Ç–∞—Ç: –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ `data/LUNA16/processed/`

**‚ö†Ô∏è –í–∞–∂–Ω–æ**: –ü–æ—Å–ª–µ —Ä–µ—Å—ç–º–ø–ª–∏–Ω–≥–∞ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –º–∏—Ä–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.

## üöÄ –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏

### –ë–∞–∑–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ

```bash
python train.py
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—É—á–µ–Ω–∏—è (–≤ `train.py`):

```python
trainer = Trainer(
    data_dir='data/LUNA16/processed',
    output_dir='experiments/luna16_unet',
    num_epochs=100,              # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö
    batch_size=2,                # –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç GPU –ø–∞–º—è—Ç–∏)
    learning_rate=1e-4,          # Learning rate
    weight_decay=1e-5,           # Weight decay –¥–ª—è AdamW
    num_workers=4,               # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ workers –¥–ª—è DataLoader
    device='cuda',               # 'cuda' –∏–ª–∏ 'cpu'
    mixed_precision=True,        # Mixed precision training
    checkpoint_interval=5        # –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤
)
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—É—á–µ–Ω–∏—è

```bash
# –ó–∞–ø—É—Å–∫ TensorBoard
tensorboard --logdir experiments/luna16_unet/logs_*
```

–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: http://localhost:6006

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—É—á–µ–Ω–∏—è

–°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `experiments/luna16_unet/`:
- `checkpoints/best_model.pth` - –ª—É—á—à–∞—è –º–æ–¥–µ–ª—å
- `checkpoints/checkpoint_epoch_*.pth` - –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —á–µ–∫–ø–æ–∏–Ω—Ç—ã
- `logs_*/` - –ª–æ–≥–∏ –¥–ª—è TensorBoard

## üìà –í–∞–ª–∏–¥–∞—Ü–∏—è

–ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è –∑–∞–ø—É—Å—Ç–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é:

```bash
python validate.py
```

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- `validation_results.csv` - –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞
- `metrics_distribution.png` - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏ (mean ¬± std –¥–ª—è –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫)

## üîÆ –ò–Ω—Ñ–µ—Ä–µ–Ω—Å

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

```bash
python infer.py
```

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ `experiments/luna16_unet/inference/`:
- `predicted_masks/` - –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–µ –º–∞—Å–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ .npy
- `visualizations/` - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π (—Å—Ä–µ–∑—ã —Å –Ω–∞–ª–æ–∂–µ–Ω–∏–µ–º)
- `*_nodules.npy` - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö —É–∑–µ–ª–∫–æ–≤
- `inference_summary.npy` - —Å–≤–æ–¥–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –§–æ—Ä–º–∞—Ç –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–ö–∞–∂–¥—ã–π –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–π —É–∑–µ–ª–æ–∫ —Å–æ–¥–µ—Ä–∂–∏—Ç:
```python
{
    'center_world': [x, y, z],        # –ú–∏—Ä–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–∞ (–º–º)
    'center_voxel': [x, y, z],        # Voxel –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
    'diameter_mm': 8.5,               # –î–∏–∞–º–µ—Ç—Ä —É–∑–µ–ª–∫–∞ (–º–º)
    'volume_voxels': 245,             # –û–±—ä—ë–º –≤ –≤–æ–∫—Å–µ–ª—è—Ö
    'bbox': (z_min, z_max, y_min, y_max, x_min, x_max)  # Bounding box
}
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏ (`model.py`)

```python
model = LungNodule3DUNet(
    in_channels=1,
    out_channels=1,
    channels=(32, 64, 128, 256, 512),  # –ö–∞–Ω–∞–ª—ã –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ
    strides=(2, 2, 2, 2),              # Downsampling strides
    num_res_units=2,                    # Residual units
    dropout=0.1                         # Dropout probability
)
```

### Loss —Ñ—É–Ω–∫—Ü–∏—è

```python
criterion = DiceBCELoss(
    dice_weight=0.5,   # –í–µ—Å Dice loss
    bce_weight=0.5,    # –í–µ—Å BCE loss
    smooth=1e-6        # –°–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ
)
```

### –ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ (`dataset.py`)

- **RandRotate90d**: –≤—Ä–∞—â–µ–Ω–∏–µ –Ω–∞ 90¬∞ (prob=0.5)
- **RandFlipd**: –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ –ø–æ –æ—Å—è–º (prob=0.5)
- **RandGaussianNoised**: –≥–∞—É—Å—Å–æ–≤ —à—É–º (prob=0.3, std=0.05)
- **RandScaleIntensityd**: –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏ (prob=0.3, factors=0.1)
- **RandShiftIntensityd**: —Å–¥–≤–∏–≥ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏ (prob=0.3, offsets=0.1)
- **RandAffined**: –∞—Ñ—Ñ–∏–Ω–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ (prob=0.3)

## üìä –ú–µ—Ç—Ä–∏–∫–∏

–ü—Ä–æ–µ–∫—Ç –≤—ã—á–∏—Å–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏:

1. **Dice Coefficient**: 
   ```
   Dice = 2 * |Pred ‚à© GT| / (|Pred| + |GT|)
   ```

2. **Sensitivity (Recall, TPR)**:
   ```
   Sensitivity = TP / (TP + FN)
   ```

3. **Precision (PPV)**:
   ```
   Precision = TP / (TP + FP)
   ```

4. **Recall** (–¥—É–±–ª–∏—Ä—É–µ—Ç Sensitivity –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã)

## ‚öôÔ∏è –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ
- **GPU**: NVIDIA GPU —Å 8+ GB VRAM (–¥–ª—è batch_size=2)
- **RAM**: 16 GB
- **–î–∏—Å–∫**: 50 GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- **CUDA**: 11.8 –∏–ª–∏ –≤—ã—à–µ

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ
- **GPU**: NVIDIA RTX 3090 / A6000 (24 GB VRAM)
- **RAM**: 32 GB
- **–î–∏—Å–∫**: 100 GB SSD
- **CUDA**: 12.1

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö GPU

–î–ª—è GPU —Å –º–µ–Ω—å—à–µ–π –ø–∞–º—è—Ç—å—é:
```python
# –í train.py
batch_size=1                    # –£–º–µ–Ω—å—à–∏—Ç–µ batch size
channels=(16, 32, 64, 128, 256) # –£–º–µ–Ω—å—à–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–∞–ª–æ–≤

# –í preprocess.py
target_size=(48, 192, 192)      # –£–º–µ–Ω—å—à–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
```

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞: CUDA out of memory

**–†–µ—à–µ–Ω–∏–µ**:
```python
# –£–º–µ–Ω—å—à–∏—Ç–µ batch_size
batch_size = 1

# –ò–ª–∏ —É–º–µ–Ω—å—à–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
target_size = (48, 192, 192)

# –ò–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç–µ mixed precision
mixed_precision = False
```

### –û—à–∏–±–∫–∞: FileNotFoundError –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö

**–†–µ—à–µ–Ω–∏–µ**:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–ø—É—â–µ–Ω–∞ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ (`python preprocess.py`)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ `processed_files.txt`

### –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π

**–†–µ—à–µ–Ω–∏—è**:
1. –£–≤–µ–ª–∏—á—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö –æ–±—É—á–µ–Ω–∏—è
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π learning rate (1e-3 –∏–ª–∏ 5e-5)
3. –£–≤–µ–ª–∏—á—å—Ç–µ –≤–µ—Å Dice loss: `dice_weight=0.7, bce_weight=0.3`
4. –î–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏–π
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤ (—É–∑–µ–ª–∫–∏ vs —Ñ–æ–Ω)

### SimpleITK –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª—ã

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ SimpleITK
pip uninstall SimpleITK
pip install SimpleITK>=2.2.0
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–ø–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω)

```bash
# 1. –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞
python preprocess.py

# 2. –û–±—É—á–µ–Ω–∏–µ (–∑–∞–π–º—ë—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤)
python train.py

# 3. –í–∞–ª–∏–¥–∞—Ü–∏—è
python validate.py

# 4. –ò–Ω—Ñ–µ—Ä–µ–Ω—Å
python infer.py
```

### –û–±—É—á–µ–Ω–∏–µ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

```python
# custom_train.py
from train import Trainer

trainer = Trainer(
    data_dir='data/LUNA16/processed',
    output_dir='experiments/custom_run',
    num_epochs=150,
    batch_size=4,
    learning_rate=5e-5,
    device='cuda',
    mixed_precision=True
)

trainer.train()
```

### –ò–Ω—Ñ–µ—Ä–µ–Ω—Å –Ω–∞ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ

```python
# single_inference.py
from infer import NoduleInferencer
import numpy as np

inferencer = NoduleInferencer(
    checkpoint_path='experiments/luna16_unet/checkpoints/best_model.pth',
    output_dir='results',
    device='cuda',
    threshold=0.5
)

# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
image = np.load('data/LUNA16/processed/images/sample.npy')

# –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
mask_pred = inferencer.predict(image)

# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —É–∑–µ–ª–∫–æ–≤
metadata = np.load('data/LUNA16/processed/sample_metadata.npy', allow_pickle=True).item()
nodules = inferencer.extract_nodule_candidates(
    mask_pred, 
    metadata['origin'], 
    metadata['spacing']
)

print(f"Detected {len(nodules)} nodules")
for i, nodule in enumerate(nodules):
    print(f"Nodule {i+1}: center={nodule['center_world']}, diameter={nodule['diameter_mm']:.1f}mm")
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –î–∞—Ç–∞—Å–µ—Ç LUNA16
- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç](https://luna16.grand-challenge.org/)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://luna16.grand-challenge.org/Data/)
- [–°—Ç–∞—Ç—å—è](https://arxiv.org/abs/1612.08012)

### MONAI
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.monai.io/)
- [Tutorials](https://github.com/Project-MONAI/tutorials)
- [Model Zoo](https://github.com/Project-MONAI/model-zoo)

### 3D U-Net
- [–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç—å—è](https://arxiv.org/abs/1606.06650)
- [–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è MONAI](https://docs.monai.io/en/stable/networks.html#unet)

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–ü—Ä–æ–µ–∫—Ç –æ—Ç–∫—Ä—ã—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–∏–π:

1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –ø–æ–ø—Ä–æ–±—É–π—Ç–µ nnU-Net, V-Net, Attention U-Net
2. **Loss —Ñ—É–Ω–∫—Ü–∏–∏**: Focal Loss, Tversky Loss, Boundary Loss
3. **–ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞**: CRF, –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
4. **–ê–Ω—Å–∞–º–±–ª–∏**: –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π
5. **–ú–µ—Ç—Ä–∏–∫–∏**: FROC –∞–Ω–∞–ª–∏–∑, Free-Response ROC

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT. –î–∞—Ç–∞—Å–µ—Ç LUNA16 –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –ª–∏—Ü–µ–Ω–∑–∏—é - —Å–º. –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç.

## ‚úâÔ∏è –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ Issues –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

## üéØ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è –Ω–∞ –ø–æ–ª–Ω–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ LUNA16 (888 –ö–¢-—Å–∫–∞–Ω–æ–≤) –≤ —Ç–µ—á–µ–Ω–∏–µ 100 —ç–ø–æ—Ö (~8-12 —á–∞—Å–æ–≤ –Ω–∞ RTX 3090):

- **Dice Score**: 0.70-0.85
- **Sensitivity**: 0.75-0.90
- **Precision**: 0.65-0.80

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç:
- –ö–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ì–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ —ç–ø–æ—Ö –æ–±—É—á–µ–Ω–∏—è
- –ë–∞–ª–∞–Ω—Å–∞ –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏–π

## üîÑ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

- **v1.0.0** (—Ç–µ–∫—É—â–∞—è) - –±–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å 3D U-Net
- –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è: multi-scale inference, test-time augmentation, FROC –º–µ—Ç—Ä–∏–∫–∏

---

**–£–¥–∞—á–∏ –≤ –æ–±—É—á–µ–Ω–∏–∏ –º–æ–¥–µ–ª–∏! üöÄ**